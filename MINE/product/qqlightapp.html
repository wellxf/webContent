<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta itemprop="name" content="挖藕智能科技轻app" />
    <meta itemprop="description" content="挖藕智能科技的qq物联轻app页面" />
    <meta itemprop="image" content="http://wa-ou.com/images/lightapp-logo.png" />
    <title>我的开关</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <base />
    <style>
     html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;height:100%}body{font-family:"Microsoft Yahei","\5FAE\8F6F\96C5\9ED1",arial,sans-serif;line-height:1.6;height:100%}*{margin:0;padding:0}ul,ol{padding-left:0;list-style-type:none}a{text-decoration:none}div#container{width:100%;height:100%}div#head{position:absolute;width:100%;height:52%;border-style:solid;border-width:0 0 1px;border-color:#B8B8B8;overflow-y:scroll}div#middle{position:absolute;width:100%;height:45%;bottom:0;text-align:center;padding:0;over-flow:hidden;display:inline-block;vertical-align:text-top}div#foot{position:fixed;bottom:0;width:100%;overflow:auto;height:8%;background-color:#F5F5F5;clear:both;text-align:center;min-height:40px}.input-select{position:absolute;width:68%;float:left;height:80%;border:0;outline:0;font-size:16px;text-align:left;left:10px;right:6px;top:10%;bottom:10%}.input-input{position:absolute;width:60%;height:-80%;float:left;border-style:none;font-size:16px;text-align:left;left:12px;right:6px;top:15%;bottom:18%}.sendButton{position:absolute;top:10%;bottom:10%;right:10px;overflow:auto;height:80%;width:20%;text-align:center;float:right;background-color:#FFF;border-style:none;border-radius:4px;margin:auto;font-size:16px}.switchButton{height:80%;background:url(http://wa-ou.com/resources/images/products/qqlightapp-switch-button.jpg) no-repeat center center;background-size:cover;border-radius:400px;border-style:none}.switchButton:hover{background-color:#5788af;border:1px outset #2683cf;color:#fcffdf;padding:3px;margin:1px;text-decoration:none;border-radius:400px}.switchButton:active{background-color:#67b4cf;border:1px inset #1d659f;color:#e0ffaf;padding:4px 2px 2px 4px;margin:1px;text-decoration:none;border-radius:80px}.line1{position:absolute;left:35px;color:gray;font-size:28px}.line2{position:absolute;right:35px;color:gray;font-size:28px}.sender{clear:both;padding:20px 0 0}.sender div:nth-of-type(1){float:left}.sender div:nth-of-type(2){background-color:#F5F5F5;float:left;margin:0 7px 7px 10px;padding:7px 7px 7px 0;border-radius:5px;font-size:16px}.receiver div:first-child img,.sender div:first-child img{width:33px;height:33px}.receiver{clear:both}.receiver div:nth-child(1){float:right}.receiver div:nth-of-type(2){float:right;background-color:#F5F5F5;margin:0 7px 7px 10px;padding:7px 0 7px 7px;border-radius:5px;font-size:16px}.left_triangle{height:0;width:0;border-width:5px;border-style:solid;border-color:transparent #F5F5F5 transparent transparent;position:relative;left:-10px;top:2px}.right_triangle{height:0;width:0;border-width:5px;border-style:solid;border-color:transparent transparent transparent #F5F5F5;position:relative;right:-10px;top:2px}  
   
    </style>
</head>

<body>
    <div id="container">
        <div id="head"></div>
        
        <div id="middle">
            <button class="switchButton" id="switchButton" style=""  onClick="clickSwitchButton()" ></button>
        </div>
        
        <div id="foot" >     
            <select  class="input-select"  id="inputTextSelect" onchange="setInputTextBoxValueAccordingtoSelect(this)" onClick="setInputTextBoxValueToFirstValue(this)" onFocus="setInputTextBoxValueToFirstValue(this)">

			</select>
			<input class="input-input" id="inputTextBox" placeholder="点击进行辅助输入" oninput="inputTextChange()" onClick="inputFieldOnClick()"/>
            <button class="sendButton" id="sendButton" disabled="disabled" onClick="clickSendButton()">发送</button>
        </div>
    </div>
    <script>
    function clickLine(e){document.getElementById("inputTextBox").value=e,document.getElementById("sendButton").removeAttribute("disabled")}function setInputTextBoxValueAccordingtoSelect(e){e.nextElementSibling.value=e.value,inputTextChange()}function setInputTextBoxValueToFirstValue(e){""==e.nextElementSibling.value&&(e.nextElementSibling.value=e.value,inputTextChange())}function inputFieldOnClick(){var e=document.getElementById("inputTextBox");if(0==e.value.length){var n,t=document.getElementById("inputTextSelect");n=document.createEvent("MouseEvents"),n.initMouseEvent("mousedown",!0,!0,window),t.dispatchEvent(n)}}function inputTextChange(){var e=document.getElementById("inputTextBox");""!=e.value?document.getElementById("sendButton").removeAttribute("disabled"):document.getElementById("sendButton").disabled="disabled"}function outInputMode(){}function clickSwitchButton(){var e=(document.getElementById("switchButton"),500001);waitingMessaegReplyID=e,device.send({datapoint:[{id:e,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onSuccess:function(e){head.appendChild("0x00"==e.charAt(0)?createReceiver("done（临时显示一下）"):"0x01"==e.charAt(0)?createReceiver("失败了（临时显示一下）"):createReceiver("返回的是不是01也不是00（临时显示一下）"))},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function pushMessageIntoHeadPanel(e,n){var t=document.getElementById("head");"sender"==e?t.appendChild(createSender(n)):"receiver"==e&&t.appendChild(createReceiver(n)),t.scrollTop=t.scrollHeight}function isNum(e){return null!=e&&""!=e?!isNaN(e):!1}function changeChineseToNumber(e){return isNum(e)?Number(e):("半"==e?e=.5:"零"==e?e=0:"一"==e?e=1:"两"==e?e=2:"二"==e?e=2:"三"==e?e=3:"四"==e?e=4:"五"==e?e=5:"六"==e?e=6:"七"==e?e=7:"八"==e?e=8:"九"==e?e=9:"十"==e?e=10:"十一"==e?e=11:"十二"==e?e=12:"十三"==e?e=13:"十四"==e?e=14:"十五"==e?e=15:"十六"==e?e=16:"十七"==e?e=17:"十八"==e?e=18:"十九"==e?e=19:"二十"==e?e=20:"二十一"==e?e=21:"二十二"==e?e=22:"二十三"==e?e=23:"二十四"==e?e=24:"二十五"==e?e=25:"二十六"==e?e=26:"二十七"==e?e=27:"二十八"==e?e=28:"二十九"==e?e=29:"三十"==e?e=30:"三十一"==e?e=31:"三十二"==e?e=32:"三十三"==e?e=33:"三十四"==e?e=34:"三十五"==e?e=35:"三十六"==e?e=36:"三十七"==e?e=37:"三十八"==e?e=38:"三十九"==e?e=39:"四十"==e?e=40:"四十一"==e?e=41:"四十二"==e?e=42:"四十三"==e?e=43:"四十四"==e?e=44:"四十五"==e?e=45:"四十六"==e?e=46:"四十七"==e?e=47:"四十八"==e?e=48:"四十九"==e?e=49:"五十"==e?e=50:"五十一"==e?e=51:"五十二"==e?e=52:"五十三"==e?e=53:"五十四"==e?e=54:"五十五"==e?e=55:"五十六"==e?e=56:"五十七"==e?e=57:"五十八"==e?e=58:"五十九"==e?e=59:"六十"==e?e=60:(setTimeout(pushMessageIntoHeadPanel,500,"receiver","这个数也太大,我识别不了"),e=-1),e)}function beautyMinutes(e){return 0==e?"00":e.toString()}function sendDelayMessage(e){e=e.replace("个小时","小时"),e=e.replace("个半小时","小时30分钟");var n=e.indexOf("小时"),t=new Date,i=t.getFullYear()-2e3,a=t.getMonth()+1,s=t.getDate(),r=t.getHours(),o=t.getMinutes(),u=t.getSeconds(),c=0,d=0,g=255,l=255,v=1,p=0;n>0&&(c=e.substring(0,n),c=changeChineseToNumber(c));var f=e.indexOf("分钟");f>0&&(d=n>0?e.substring(n+2,f):e.substring(0,f),d=changeChineseToNumber(d)),d+=c%1*60,c=parseInt(c),d+=o,d>=60&&(d-=60,c+=1),c+=r,c>=24&&(c%=24);var h=0;e.indexOf("开")>0&&(h=1);var m=500003;waitingMessaegReplyID=m,device.send({datapoint:[{id:m,apiName:"set_data_point",type:"bytearray",value:[255&i,255&a,255&s,255&r,255&o,255&u,255&c,255&d,255&g,255&l,255&v,255&h,255&p]}],vibrate:1,onSuccess:function(){device.log("on_time_switch onSuccess: "),pushMessageIntoHeadPanel("receiver","收到!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function sendBreathLightMessage(e){var n=e.indexOf("开"),t=1;0>n&&(t=0);var i=500004;waitingMessaegReplyID=i,device.send({datapoint:[{id:i,apiName:"set_data_point",type:"int32",value:t}],vibrate:1,onSuccess:function(e){device.log("delay_switch onSuccess: "+JSON.stringify(e)),pushMessageIntoHeadPanel("receiver","好的!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function sendCancelMessage(){var e=500002;waitingMessaegReplyID=e,device.send({datapoint:[{id:e,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onSuccess:function(e){device.log("cancel onSuccess: "+JSON.stringify(e))},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function getMinuteFromString(e){var n=e,t=e.indexOf("点");return t>=0&&(n=e.substring(t+1,e.length)),n.indexOf("分")>0&&(n=n.substring(0,n.indexOf("分"))),"半"==n?30:""!=n?changeChineseToNumber(n):0}function getHourFromString(e){var n=e.substring(0,e.indexOf("点"));return changeChineseToNumber(n)}function replaceAll(e,n,t){return e.indexOf(n)>0?e.replace(new RegExp(n,"g"),t):e}function sendOnTimeSwitchMessage(e){e=e.replace("明早","明天早上"),e=e.replace("明晚","明天晚上"),e=replaceAll(e,":","点"),e=replaceAll(e,"：","点");var n=-1,t=0,i=-1,a=0,s=e.indexOf("下午"),r=!1,o=!1;0>s&&(s=e.indexOf("晚上")),s>=0?r=!0:(s=e.indexOf("早上"),0>s&&(s=e.indexOf("上午")),0>s&&(s=e.indexOf("早晨")));var u=1,c=0;e.indexOf("明天")>=0?(u=1,c=1):e.indexOf("后天")>=0?(u=1,c=2):e.indexOf("每天")>=0&&(u=-1),s>=0?(o=!0,s+=2):(s=e.indexOf("明天"),0>s&&(s=e.indexOf("每天")),0>s&&(s=e.indexOf("后天")),0>s?s=0:s+=2);var d=e.indexOf("打开"),g=1;0>d&&(d=e.indexOf("关"),g=0),0>d&&(d=e.indexOf("开"),g=1);var l=e.substring(s,d);n=l.substring(0,l.indexOf("点")),n=changeChineseToNumber(n);var v=new Date,p=v.getFullYear()-2e3,f=v.getMonth()+1,h=v.getDate(),m=v.getHours(),x=v.getMinutes(),M=v.getSeconds(),S=l.indexOf("到");S>0?(t=getMinuteFromString(l.substring(0,S)),l=l.substring(S+1,l.length),i=getHourFromString(l),a=getMinuteFromString(l),12>=i&&r?i+=12:1>c&&12>=n&&!o&&(n>m||m==n&&t>x||(12+n>m||m==12+n&&t>x)&&(r=!0,i+=12))):(t=getMinuteFromString(l),12>=n&&!o&&(n>m||m==n&&t>x||(12+n>m||m==12+n&&t>x)&&(r=!0)),c>0&&!o&&(r=!1)),12>=n&&r&&(n+=12),24==n&&(n=0),24==i&&(i=0);var y=500003;waitingMessaegReplyID=y,device.send({datapoint:[{id:y,apiName:"set_data_point",type:"bytearray",value:[255&p,255&f,255&h,255&m,255&x,255&M,255&n,255&t,255&i,255&a,255&u,255&g,255&c]}],vibrate:1,onSuccess:function(){device.log("on_time_switch onSuccess: "),pushMessageIntoHeadPanel("receiver","收到!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function isDelaySwitchMessage(e){var n=new RegExp("后开|后关");return n.test(e)}function isOnTimeSwitchMessage(e){var n=new RegExp("到|点开|分开|点关|分关|半关|半开"),t=n.test(e);if(!t){var i=new RegExp("点|:|："),a=new RegExp("开|关");t=i.test(e)&&a.test(e)}return t}function isBreathLightControlMessage(e){var n=new RegExp("到");return n.test(e)}function inputisValid(e){var n=new RegExp("开|关|打开|关闭|开灯|关灯|取消|不要关了|不要开了|恢复|cancel");return n.test(e)}function isBreathLightControlMessage(e){var n=new RegExp("呼吸灯");return n.test(e)}function isCancelMessage(e){var n=new RegExp("取消|不要关了|不要开了|恢复|cancel");return n.test(e)}function clickSendButton(){var e=document.getElementById("inputTextBox"),n=e.value;pushMessageIntoHeadPanel("sender",n),document.getElementById("sendButton").disabled="disabled",e.value="",e.placeholder="点击进行辅助输入",n=n.replace(/\s+/g,""),n=replaceAll(n,"点钟","点"),n=replaceAll(n,"点整","点");var t=(inputisValid(n),!1);inputisValid(n)?isDelaySwitchMessage(n)?(sendDelayMessage(n),t=!0):isOnTimeSwitchMessage(n)?(sendOnTimeSwitchMessage(n),t=!0):isBreathLightControlMessage(n)?(sendBreathLightMessage(n),t=!0):isCancelMessage(n)?sendCancelMessage(n):setTimeout(pushMessageIntoHeadPanel,500,"receiver","我暂时理解不了您说的话，我会努力学习的。"):setTimeout(pushMessageIntoHeadPanel,500,"receiver","我暂时理解不了您说的话"),t&&addMessageIntoCookie(n)}
    </script>
    <script src="http://qzonestyle.gtimg.cn/open/mobile/light_app/js/device.js"></script>
    <script>
    function createReceiver(e){var t=document.createElement("div");t.className="receiver";var n=document.createElement("div"),a=document.createElement("img");n.appendChild(a),a.src="http://wa-ou.com/resources/images/products/qqlightapp-yong.png",t.appendChild(n);var i=document.createElement("div");t.appendChild(i);var s=document.createElement("div");return i.appendChild(s),s.className="right_triangle",i.innerHTML+="<span>"+e+"</span>",t}function createSender(e){var t=document.createElement("div");t.className="sender";var n=document.createElement("div"),a=document.createElement("img");n.appendChild(a),a.src="http://wa-ou.com/resources/images/products/qqlightapp-switch-button.png",t.appendChild(n);var i=document.createElement("div");t.appendChild(i);var s=document.createElement("div");return i.appendChild(s),s.className="left_triangle",i.innerHTML+="<span>"+e+"</span>",i.onclick=function(){clickLine(e)},t}function setGuideMessage(){document.getElementById("allGuideMessage1").value="on"==switchCurrentState?"半小时后关灯":"半小时后开灯"}function receiveMessage(){device.onReceive(function(e){switch(e.id){case 500010:"0x11"==e.value[0]?(device.log("现在灯是开的状态"),switchCurrentState="on"):"0x10"==e.value[0]?(switchCurrentState="off",device.log("现在开关是关闭状态")):switchCurrentState="on",setGuideMessage();break;case 500003:if(waitingMessaegReplyID==e.id){var t="收到!";alreadySendCancelGuideMessage||(t+="需要取消时，告诉我就可以啦。",alreadySendCancelGuideMessage=!0),pushMessageIntoHeadPanel("receiver",t)}else device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id);break;case 500004:if(waitingMessaegReplyID==e.id){var t="好的，我记下了!";alreadySendCancelGuideMessage||(t+="需要取消时，告诉我就可以啦。",alreadySendCancelGuideMessage=!0),pushMessageIntoHeadPanel("receiver",t)}else device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id);break;case 500002:waitingMessaegReplyID==e.id?pushMessageIntoHeadPanel("receiver","收到，已经取消了!"):device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id)}}),device.onDeviceInfoChange=function(){device.log("I already capture this, so to hide off-line message")}}function getCurrentSwitchState(){var e=500010;waitingMessaegReplyID=e,device.send({datapoint:[{id:e,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onAck:function(){}})}function setSwitchButtonSize(){var e=document.getElementById("middle"),t=document.getElementById("switchButton"),n=.8*e.getBoundingClientRect().height;device.log(n),parseInt(n)<180?n=.95*parseInt(n):parseInt(n)<130?n=.9*parseInt(n):parseInt(n)<100&&(n=.7*parseInt(n)),t.style.width=n+"px",t.style.height=t.style.width}function getCookie(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):""}function setCookie(e,t){var n=30,a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+a.toGMTString()}function addMessageIntoCookie(e){0==sendMessageInCookie.length&&(sendMessageInCookie=getCookie(cookieKey));for(var t=sendMessageInCookie.split(";"),n=0;n<t.length;n++)if(t[n]==e)return;for(var n=0;n<preDefinedMessages.length-t.length;n++)if(preDefinedMessages[n]==e)return;var a=t.length;a>=totalMessageSizeInCookie&&(a=totalMessageSizeInCookie);for(var n=a-1;n>0;n--)t[n]=t[n-1];t[0]=e,sendMessageInCookie="";for(var n=0;n<t.length;n++)0!=t[n].length&&(sendMessageInCookie=sendMessageInCookie+t[n]+";");setCookie(cookieKey,sendMessageInCookie),setSelectOptions()}function setSelectOptions(){var e=document.getElementById("inputTextSelect");0==sendMessageInCookie.length&&(sendMessageInCookie=getCookie(cookieKey));var t=sendMessageInCookie.split(";");e.innerHTML="";for(var n=0;n<t.length;n++)if(t[n].length>0){var a=document.createElement("option");a.value=t[n],a.innerHTML=t[n],e.appendChild(a)}var i=preDefinedMessages.length-t.length;device.debug&&(preDefinedMessages=allDetailedTestMessages,i=preDefinedMessages.length);for(var n=0;i>n;n++)if(t.indexOf(preDefinedMessages[n])<=-1){var a=document.createElement("option");a.value=preDefinedMessages[n],a.innerHTML=preDefinedMessages[n],e.appendChild(a)}}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");device.log(location);var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function initGuideMessages(){var e=getParameterByName("deviceRemark"),t=getParameterByName("userName");""==e&&(e="智能灯"),""!=t&&"蓝牙开关"!=t&&head.appendChild(createReceiver("您好，"+t+"！")),setTimeout(pushMessageIntoHeadPanel,300,"receiver","我是"+e+"，您可以直接发信息给我。"),setTimeout(pushMessageIntoHeadPanel,300,"receiver","点输入框有提示哦！")}device.debug=0,switchCurrentState="on",waitingMessaegReplyID=500010,sendMessageInCookie="",alreadySendCancelGuideMessage=!1,totalMessageSizeInCookie=5,cookieKey="wa-ou-sent-message",preDefinedMessages=["晚上6点到8点开灯","12点关灯","后天11点关灯","明早5点开灯","每天6点到7点开灯","半小时后关灯","关闭呼吸灯","明早6点开灯"],allDetailedTestMessages=[],window.onload=function(){document.getElementById("head");setSwitchButtonSize(),receiveMessage(),getCurrentSwitchState(),setSelectOptions(),initGuideMessages()},window.addEventListener("orientationchange",function(){setSwitchButtonSize()},!1);
        
    </script>
    <!--[if !IE]>|xGv00|9905a873c2f7497c0c0cd7e24cc02554<![endif]-->
</body>
</html>
