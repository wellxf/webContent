<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta itemprop="name" content="挖藕智能科技轻app" />
    <meta itemprop="description" content="挖藕智能科技的qq物联轻app页面" />
    <meta itemprop="image" content="http://wa-ou.com/images/lightapp-logo.png" />
    <title>我的开关</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <base />
    <style>
        
   html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;height:100%}body{font-family:"Microsoft Yahei","\5FAE\8F6F\96C5\9ED1",arial,sans-serif;line-height:1.6;height:100%}*{margin:0;padding:0}ul,ol{padding-left:0;list-style-type:none}a{text-decoration:none}div#container{width:100%;height:100%}div#head{position:absolute;width:100%;height:52%;border-style:solid;border-width:0 0 1px;border-color:#B8B8B8;overflow-y:scroll}div#middle{position:absolute;width:100%;height:45%;bottom:0;text-align:center;padding:0;over-flow:hidden;display:inline-block;vertical-align:text-top}div#foot{position:fixed;bottom:0;width:100%;overflow:auto;height:8%;background-color:#F5F5F5;clear:both;text-align:center;min-height:40px}.input-select{position:absolute;width:68%;float:left;height:80%;border:0;outline:0;font-size:16px;text-align:left;left:10px;right:6px;top:10%;bottom:10%}.input-input{position:absolute;width:60%;height:-80%;float:left;border-style:none;font-size:16px;text-align:left;left:12px;right:6px;top:15%;bottom:18%}.sendButton{position:absolute;top:10%;bottom:10%;right:10px;overflow:auto;height:80%;width:20%;text-align:center;float:right;background-color:#FFF;border-style:none;border-radius:4px;margin:auto;font-size:16px}.switchButton{height:80%;background:url(http://wa-ou.com/resources/images/products/qqlightapp-switch-button.jpg) no-repeat center center;background-size:cover;border-radius:400px;border-style:none}.switchButton:hover{background-color:#5788af;border:1px outset #2683cf;color:#fcffdf;padding:3px;margin:1px;text-decoration:none;border-radius:400px}.switchButton:active{background-color:#67b4cf;border:1px inset #1d659f;color:#e0ffaf;padding:4px 2px 2px 4px;margin:1px;text-decoration:none;border-radius:400px}.line1{position:absolute;left:35px;color:gray;font-size:28px}.line2{position:absolute;right:35px;color:gray;font-size:28px}.sender{clear:both;padding:20px 0 0}.sender div:nth-of-type(1){float:left}.sender div:nth-of-type(2){background-color:#F5F5F5;float:left;margin:0 7px 7px 10px;padding:7px 7px 7px 0;border-radius:5px;font-size:16px}.receiver div:first-child img,.sender div:first-child img{width:33px;height:33px}.receiver{clear:both}.receiver div:nth-child(1){float:right}.receiver div:nth-of-type(2){float:right;background-color:#F5F5F5;margin:0 7px 7px 10px;padding:7px 0 7px 7px;border-radius:5px;font-size:16px}.left_triangle{height:0;width:0;border-width:5px;border-style:solid;border-color:transparent #F5F5F5 transparent transparent;position:relative;left:-10px;top:2px}.right_triangle{height:0;width:0;border-width:5px;border-style:solid;border-color:transparent transparent transparent #F5F5F5;position:relative;right:-10px;top:2px}
    </style>
</head>

<body>
    <div id="container">
        <div id="head"></div>
        
        <div id="middle">
            <button class="switchButton" id="switchButton" style=""  onClick="clickSwitchButton()" ></button>
        </div>
        
        <div id="foot" >     
            <select  class="input-select"  id="inputTextSelect" onchange="setInputTextBoxValueAccordingtoSelect(this)" onClick="setInputTextBoxValueToFirstValue(this)" onFocus="setInputTextBoxValueToFirstValue(this)">

			</select>
			<input class="input-input" id="inputTextBox" placeholder="点击进行辅助输入" oninput="inputTextChange()" onClick="inputFieldOnClick()"/>
            <button class="sendButton" id="sendButton" disabled="disabled" onClick="clickSendButton()">发送</button>
        </div>
    </div>
    <script>
    function clickLine(e){document.getElementById("inputTextBox").value=e,document.getElementById("sendButton").removeAttribute("disabled")}function setInputTextBoxValueAccordingtoSelect(e){e.nextElementSibling.value=e.value,inputTextChange()}function setInputTextBoxValueToFirstValue(e){""==e.nextElementSibling.value&&(e.nextElementSibling.value=e.value,inputTextChange())}function inputFieldOnClick(){var e=document.getElementById("inputTextBox");if(0==e.value.length){var n,t=document.getElementById("inputTextSelect");n=document.createEvent("MouseEvents"),n.initMouseEvent("mousedown",!0,!0,window),t.dispatchEvent(n)}}function inputTextChange(){var e=document.getElementById("inputTextBox");""!=e.value?document.getElementById("sendButton").removeAttribute("disabled"):document.getElementById("sendButton").disabled="disabled"}function clickSwitchButton(){var e=(document.getElementById("switchButton"),500001);waitingMessaegReplyID=e,device.send({datapoint:[{id:e,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onSuccess:function(e){"0x00"==e.charAt(0)?head.appendChild(createReceiver("done（临时显示一下）")):"0x01"==e.charAt(0)?head.appendChild(createReceiver("失败了（临时显示一下）")):head.appendChild(createReceiver("返回的是不是01也不是00（临时显示一下）"))},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function pushMessageIntoHeadPanel(e,n){var t=document.getElementById("head");"sender"==e?t.appendChild(createSender(n)):"receiver"==e&&t.appendChild(createReceiver(n)),t.scrollTop=t.scrollHeight}function isNum(e){return null!=e&&""!=e?!isNaN(e):!1}function changeTenToNumber(e){return e="半"==e?.5:"零"==e?0:"一"==e?1:"两"==e?2:"二"==e?2:"三"==e?3:"四"==e?4:"五"==e?5:"六"==e?6:"七"==e?7:"八"==e?8:"九"==e?9:"十"==e?10:-1}function changeChineseToNumber(e){if(isNum(e))return Number(e);if("半"==e)e=.5;else{var n=0,t=10,i=0;e.length>=3?(n=changeTenToNumber(e.charAt(0)),i=changeTenToNumber(e.charAt(2))):2==e.length?(n=changeTenToNumber(e.charAt(0)),i=changeTenToNumber(e.charAt(1)),10==i&&(i=0)):e.length>=1&&(i=changeTenToNumber(e.charAt(0))),e=n*t+i}return e}function beautyMinutes(e){return 0==e?"00":e.toString()}function printDeviceLogFor500003(e,n,t,i,a,r,s,o,u,c,d,g,l){var v="现在时间（20"+e.toString()+"年"+n.toString()+"月"+t+"日 "+i.toString()+":"+beautyMinutes(a)+":"+beautyMinutes(r)+") ";1==g?(v=v+"开灯时间（"+s.toString()+":"+beautyMinutes(o)+") ",255!=u&&(v=v+"关灯时间（"+u.toString()+":"+beautyMinutes(c)+") ")):(v=v+"关灯时间（"+s.toString()+":"+beautyMinutes(o)+") ",255!=u&&(v=v+"开灯时间（"+u.toString()+":"+beautyMinutes(c)+") ")),255==d?v+=" 重复次数: -1 (表示无限)":v=v+" 重复次数: "+d.toString(),1==l?v+=" 从明天开始":2==l?v+=" 从后天开始":0!=l&&(v+=" startDayCount不是1也不是2，代码错误"),device.log(v)}function sendDelayMessage(e){e=e.replace("个小时","小时"),e=e.replace("个半小时","小时30分钟"),e=e.replace("分后","分钟后");var n=e.indexOf("小时"),t=new Date,i=t.getFullYear()-2e3,a=t.getMonth()+1,r=t.getDate(),s=t.getHours(),o=t.getMinutes(),u=t.getSeconds(),c=0,d=0,g=255,l=255,v=1,p=0;n>0&&(c=e.substring(0,n),c=changeChineseToNumber(c));var h=e.indexOf("分钟");if(h>0&&(d=n>0?e.substring(n+2,h):e.substring(0,h),d=changeChineseToNumber(d)),0>c||0>d||c+d==0)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");d+=c%1*60,c=parseInt(c),d+=o,d>=60&&(c+=parseInt(d/60),d%=60),c+=s,c>=24&&(c%=24);var f=0;e.indexOf("开")>0&&(f=1),printDeviceLogFor500003(255&i,255&a,255&r,255&s,255&o,255&u,255&c,255&d,255&g,255&l,255&v,255&f,255&p);var m=500003;waitingMessaegReplyID=m,device.send({datapoint:[{id:m,apiName:"set_data_point",type:"bytearray",value:[255&i,255&a,255&r,255&s,255&o,255&u,255&c,255&d,255&g,255&l,255&v,255&f,255&p]}],vibrate:1,onSuccess:function(e){device.log("on_time_switch onSuccess: "),pushMessageIntoHeadPanel("receiver","收到!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function sendBreathLightMessage(e){var n=e.indexOf("开"),t=1;0>n&&(t=0);var i=500004;waitingMessaegReplyID=i,device.send({datapoint:[{id:i,apiName:"set_data_point",type:"int32",value:t}],vibrate:1,onSuccess:function(e){device.log("delay_switch onSuccess: "+JSON.stringify(e)),pushMessageIntoHeadPanel("receiver","好的!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function sendCancelMessage(e){var n=500002;waitingMessaegReplyID=n,device.send({datapoint:[{id:n,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onSuccess:function(e){device.log("cancel onSuccess: "+JSON.stringify(e))},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function getMinuteFromString(e){var n=e,t=e.indexOf("点");return t>=0&&(n=e.substring(t+1,e.length)),n.indexOf("分")>0&&(n=n.substring(0,n.indexOf("分"))),"半"==n?30:""!=n?changeChineseToNumber(n):0}function getHourFromString(e){var n=e.substring(0,e.indexOf("点"));return changeChineseToNumber(n)}function replaceAll(e,n,t){return e.indexOf(n)>0?e.replace(new RegExp(n,"g"),t):e}function sendOnTimeSwitchMessage(e){e=e.replace("明早","明天早上"),e=e.replace("明晚","明天晚上"),e=replaceAll(e,":","点"),e=replaceAll(e,"：","点");var n=-1,t=0,i=-1,a=0,r=e.indexOf("下午"),s=!1,o=!1;0>r&&(r=e.indexOf("晚上")),r>=0?s=!0:(r=e.indexOf("早上"),0>r&&(r=e.indexOf("上午")),0>r&&(r=e.indexOf("早晨")));var u=1,c=0;e.indexOf("明天")>=0?(u=1,c=1):e.indexOf("后天")>=0?(u=1,c=2):e.indexOf("每天")>=0&&(u=-1),r>=0?(o=!0,r+=2):(r=e.indexOf("明天"),0>r&&(r=e.indexOf("每天")),0>r&&(r=e.indexOf("后天")),0>r?r=0:r+=2);var d=e.indexOf("打开"),g=1;0>d&&(d=e.indexOf("关"),g=0),0>d&&(d=e.indexOf("开"),g=1);var l=e.substring(r,d);if(n=l.substring(0,l.indexOf("点")),n=changeChineseToNumber(n),0>n)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");var v=new Date,p=v.getFullYear()-2e3,h=v.getMonth()+1,f=v.getDate(),m=v.getHours(),x=v.getMinutes(),M=v.getSeconds(),b=l.indexOf("到");if(b>0){if(t=getMinuteFromString(l.substring(0,b)),l=l.substring(b+1,l.length),i=getHourFromString(l),a=getMinuteFromString(l),0>t||0>i||0>a)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");12>=i&&s?i+=12:1>c&&12>=n&&!o&&(n>m||m==n&&t>x||(12+n>m||m==12+n&&t>x)&&(s=!0,(i>n||i==n&&a>t)&&(i+=12)))}else{if(t=getMinuteFromString(l),0>t)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");12>=n&&!o&&(n>m||m==n&&t>x||(12+n>m||m==12+n&&t>x)&&(s=!0)),c>0&&!o&&(s=!1)}12>=n&&s&&(n+=12),24==n&&(n=0),24==i&&(i=0),printDeviceLogFor500003(255&p,255&h,255&f,255&m,255&x,255&M,255&n,255&t,255&i,255&a,255&u,255&g,255&c);var S=500003;waitingMessaegReplyID=S,device.send({datapoint:[{id:S,apiName:"set_data_point",type:"bytearray",value:[255&p,255&h,255&f,255&m,255&x,255&M,255&n,255&t,255&i,255&a,255&u,255&g,255&c]}],vibrate:1,onSuccess:function(e){device.log("on_time_switch onSuccess: "),pushMessageIntoHeadPanel("receiver","收到!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function isDelaySwitchMessage(e){var n=new RegExp("后开|后关");return n.test(e)}function isOnTimeSwitchMessage(e){var n=new RegExp("到|点开|分开|点关|分关|半关|半开"),t=n.test(e);if(!t){var i=new RegExp("点|:|："),a=new RegExp("开|关");t=i.test(e)&&a.test(e)}return t}function isBreathLightControlMessage(e){var n=new RegExp("到");return n.test(e)}function inputisValid(e){var n=new RegExp("开|关|打开|关闭|开灯|关灯|取消|不要关了|不要开了|恢复|cancel");return n.test(e)}function isBreathLightControlMessage(e){var n=new RegExp("呼吸灯");return n.test(e)}function isCancelMessage(e){var n=new RegExp("取消|不要关了|不要开了|恢复|cancel");return n.test(e)}function clickSendButton(){var e=document.getElementById("inputTextBox"),n=e.value;pushMessageIntoHeadPanel("sender",n),document.getElementById("sendButton").disabled="disabled",e.value="",e.placeholder="点击进行辅助输入",n=n.replace(/\s+/g,""),n=replaceAll(n,"点钟","点"),n=replaceAll(n,"点整","点");var t=(inputisValid(n),!1);inputisValid(n)?isDelaySwitchMessage(n)?(sendDelayMessage(n),t=!0):isOnTimeSwitchMessage(n)?(sendOnTimeSwitchMessage(n),t=!0):isBreathLightControlMessage(n)?(sendBreathLightMessage(n),t=!0):isCancelMessage(n)?sendCancelMessage(n):setTimeout(pushMessageIntoHeadPanel,500,"receiver","我暂时理解不了您说的话，我会努力学习的。"):setTimeout(pushMessageIntoHeadPanel,500,"receiver","我暂时理解不了您说的话"),t&&addMessageIntoCookie(n)}
    </script>
    <script src="http://qzonestyle.gtimg.cn/open/mobile/light_app/js/device.js"></script>
    <script>
        
    function createReceiver(e){var t=document.createElement("div");t.className="receiver";var n=document.createElement("div"),a=document.createElement("img");n.appendChild(a),a.src="http://wa-ou.com/resources/images/products/qqlightapp-yong.png",t.appendChild(n);var i=document.createElement("div");t.appendChild(i);var s=document.createElement("div");return i.appendChild(s),s.className="right_triangle",i.innerHTML+="<span>"+e+"</span>",t}function createSender(e){var t=document.createElement("div");t.className="sender";var n=document.createElement("div"),a=document.createElement("img");n.appendChild(a),a.src="http://wa-ou.com/resources/images/products/qqlightapp-switch-button.png",t.appendChild(n);var i=document.createElement("div");t.appendChild(i);var s=document.createElement("div");return i.appendChild(s),s.className="left_triangle",i.innerHTML+="<span>"+e+"</span>",i.onclick=function(){clickLine(e)},t}function setGuideMessage(){"on"==switchCurrentState?document.getElementById("allGuideMessage1").value="半小时后关灯":document.getElementById("allGuideMessage1").value="半小时后开灯"}function receiveMessage(){device.onReceive(function(e){switch(e.id){case 500010:"0x11"==e.value[0]?(device.log("现在灯是开的状态"),switchCurrentState="on"):"0x10"==e.value[0]?(switchCurrentState="off",device.log("现在开关是关闭状态")):switchCurrentState="on",setGuideMessage();break;case 500003:if(waitingMessaegReplyID==e.id){var t="收到!";alreadySendCancelGuideMessage||(t+="需要取消时，告诉我就可以啦。",alreadySendCancelGuideMessage=!0),pushMessageIntoHeadPanel("receiver",t)}else device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id);break;case 500004:if(waitingMessaegReplyID==e.id){var t="好的，我记下了!";alreadySendCancelGuideMessage||(t+="需要取消时，告诉我就可以啦。",alreadySendCancelGuideMessage=!0),pushMessageIntoHeadPanel("receiver",t)}else device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id);break;case 500002:waitingMessaegReplyID==e.id?pushMessageIntoHeadPanel("receiver","收到，已经取消了!"):device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id)}}),device.onDeviceInfoChange=function(e){device.log("I already capture this, so to hide off-line message")}}function getCurrentSwitchState(){var e=500010;waitingMessaegReplyID=e,device.send({datapoint:[{id:e,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onAck:function(e){}})}function setSwitchButtonSize(){var e=document.getElementById("middle"),t=document.getElementById("switchButton"),n=.8*e.getBoundingClientRect().height;device.log(n),parseInt(n)<180?n=.95*parseInt(n):parseInt(n)<130?n=.9*parseInt(n):parseInt(n)<100&&(n=.7*parseInt(n)),t.style.width=n+"px",t.style.height=t.style.width}function getCookie(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):""}function setCookie(e,t){var n=30,a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+a.toGMTString()}function addMessageIntoCookie(e){0==sendMessageInCookie.length&&(sendMessageInCookie=getCookie(cookieKey));for(var t=sendMessageInCookie.split(";"),n=0;n<t.length;n++)if(t[n]==e)return;for(var n=0;n<preDefinedMessages.length-t.length;n++)if(preDefinedMessages[n]==e)return;var a=t.length;a>=totalMessageSizeInCookie&&(a=totalMessageSizeInCookie);for(var n=a-1;n>0;n--)t[n]=t[n-1];t[0]=e,sendMessageInCookie="";for(var n=0;n<t.length;n++)0!=t[n].length&&(sendMessageInCookie=sendMessageInCookie+t[n]+";");setCookie(cookieKey,sendMessageInCookie),setSelectOptions()}function setSelectOptions(){var e=document.getElementById("inputTextSelect");0==sendMessageInCookie.length&&(sendMessageInCookie=getCookie(cookieKey));var t=sendMessageInCookie.split(";");e.innerHTML="";for(var n=0;n<t.length;n++)if(t[n].length>0){var a=document.createElement("option");a.value=t[n],a.innerHTML=t[n],e.appendChild(a)}var i=preDefinedMessages.length-t.length;device.debug&&(preDefinedMessages=allDetailedTestMessages,i=preDefinedMessages.length);for(var n=0;i>n;n++)if(t.indexOf(preDefinedMessages[n])<=-1){var a=document.createElement("option");a.value=preDefinedMessages[n],a.innerHTML=preDefinedMessages[n],e.appendChild(a)}}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function initGuideMessages(){var e=getParameterByName("deviceRemark"),t=getParameterByName("userName");""==e&&(e="智能灯"),""!=t&&"蓝牙开关"!=t&&head.appendChild(createReceiver("您好，"+t+"！")),setTimeout(pushMessageIntoHeadPanel,300,"receiver","我是"+e+"，您可以直接发信息给我。"),setTimeout(pushMessageIntoHeadPanel,300,"receiver","点输入框有提示哦！")}device.debug=!0,switchCurrentState="on",waitingMessaegReplyID=500010,sendMessageInCookie="",alreadySendCancelGuideMessage=!1,totalMessageSizeInCookie=5,isIOS=0,cookieKey="wa-ou-sent-message",preDefinedMessages=["晚上6点到8点开灯","12点关灯","后天11点关灯","明早5点开灯","每天6点到7点开灯","半小时后关灯","关闭呼吸灯","明早6点开灯"],allDetailedTestMessages=["打开呼吸灯","关闭呼吸灯","1分后关灯","23点到1点开灯","11点到1点开灯","8:20开灯","8：20开灯","8点20开灯","8点20分开灯","上午8点20开灯","下午8点20开灯","晚上8点20开灯","12点半关灯","5点半关灯","五点半关灯","21点半关灯","9点半关灯","晚上6点23分到8点27分开灯","晚上6点到8点27分开灯","晚上6点到8点五十七分开灯","晚上6点到十点五十七开灯","二十点半到零点五十七开灯","12：30到12：50关灯","12:30到12:50关灯","后天晚上9点到11点半开灯","八十八分钟后关灯","八十分钟后关灯","半小时后关灯","一个半小时后关灯","两个半小时后关灯","三个半小时后关灯","一小时50分钟后开灯","一小时一分钟后开灯","明早5点开灯","明早5点三十分开灯","每天6点到7点开灯","每天6点20到7点50开灯","五点整开灯","晚上六点钟到8点钟开灯","后天晚上六点钟到8点钟开灯","每天晚上六点钟到8点钟开灯"],window.onload=function(){document.getElementById("head");setSwitchButtonSize(),receiveMessage(),getCurrentSwitchState(),setSelectOptions(),initGuideMessages(),isIOS=/iPad|iPhone|iPod/.test(navigator.platform)},window.addEventListener("orientationchange",function(){setSwitchButtonSize()},!1);   
    </script>
    <!--[if !IE]>|xGv00|9905a873c2f7497c0c0cd7e24cc02554<![endif]-->
</body>
</html>
