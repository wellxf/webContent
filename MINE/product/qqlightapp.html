<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta itemprop="name" content="挖藕智能科技轻app" />
    <meta itemprop="description" content="挖藕智能科技的qq物联轻app页面" />
    <meta itemprop="image" content="http://wa-ou.com/images/lightapp-logo.png" />
    <title>我的开关</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <base />
    <style>
     html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;height:100%}body{font-family:"Microsoft Yahei","\5FAE\8F6F\96C5\9ED1",arial,sans-serif;line-height:1.6;height:100%}*{margin:0;padding:0}ul,ol{padding-left:0;list-style-type:none}a{text-decoration:none}div#container{width:100%;height:100%}div#head{position:absolute;width:100%;height:52%;border-style:solid;border-width:0 0 1px;border-color:#B8B8B8;overflow-y:scroll}div#middle{position:absolute;width:100%;height:45%;bottom:0;text-align:center;padding:0;over-flow:hidden;display:inline-block;vertical-align:text-top}div#foot{position:fixed;bottom:0;width:100%;overflow:auto;height:8%;background-color:#F5F5F5;clear:both;text-align:center;min-height:40px}.input-select{position:absolute;width:68%;float:left;height:80%;border:0;outline:0;font-size:16px;text-align:left;left:10px;right:6px;top:10%;bottom:10%}.input-input{position:absolute;width:60%;height:-80%;float:left;border-style:none;font-size:16px;text-align:left;left:12px;right:6px;top:15%;bottom:18%}.sendButton{position:absolute;top:10%;bottom:10%;right:10px;overflow:auto;height:80%;width:20%;text-align:center;float:right;background-color:#FFF;border-style:none;border-radius:4px;margin:auto;font-size:16px}.switchButton{height:80%;background:url(http://wa-ou.com/resources/images/products/qqlightapp-switch-button.jpg) no-repeat center center;background-size:cover;border-radius:400px;border-style:none}.switchButton:hover{background-color:#5788af;border:1px outset #2683cf;color:#fcffdf;padding:3px;margin:1px;text-decoration:none;border-radius:400px}.switchButton:active{background-color:#67b4cf;border:1px inset #1d659f;color:#e0ffaf;padding:4px 2px 2px 4px;margin:1px;text-decoration:none;border-radius:400px}.line1{position:absolute;left:35px;color:gray;font-size:28px}.line2{position:absolute;right:35px;color:gray;font-size:28px}.sender{clear:both;padding:20px 0 0}.sender div:nth-of-type(1){float:left}.sender div:nth-of-type(2){background-color:#F5F5F5;float:left;margin:0 7px 7px 10px;padding:7px 7px 7px 0;border-radius:5px;font-size:16px}.receiver div:first-child img,.sender div:first-child img{width:33px;height:33px}.receiver{clear:both}.receiver div:nth-child(1){float:right}.receiver div:nth-of-type(2){float:right;background-color:#F5F5F5;margin:0 7px 7px 10px;padding:7px 0 7px 7px;border-radius:5px;font-size:16px}.left_triangle{height:0;width:0;border-width:5px;border-style:solid;border-color:transparent #F5F5F5 transparent transparent;position:relative;left:-10px;top:2px}.right_triangle{height:0;width:0;border-width:5px;border-style:solid;border-color:transparent transparent transparent #F5F5F5;position:relative;right:-10px;top:2px}  
    </style>
</head>

<body>
    <div id="container">
        <div id="head"></div>
        
        <div id="middle">
            <button class="switchButton" id="switchButton" style=""  onClick="clickSwitchButton()" ></button>
        </div>
        
        <div id="foot" >     
            <select  class="input-select"  id="inputTextSelect" onchange="setInputTextBoxValueAccordingtoSelect(this)" onClick="setInputTextBoxValueToFirstValue(this)" onFocus="setInputTextBoxValueToFirstValue(this)">

			</select>
			<input class="input-input" id="inputTextBox" placeholder="点击进行辅助输入" oninput="inputTextChange()" onClick="inputFieldOnClick()"/>
            <button class="sendButton" id="sendButton" disabled="disabled" onClick="clickSendButton()">发送</button>
        </div>
    </div>
    <script src="http://qzonestyle.gtimg.cn/open/mobile/light_app/js/device.js"></script>
    <script>
       
    function clickLine(e){document.getElementById("inputTextBox").value=e,document.getElementById("sendButton").removeAttribute("disabled")}function setInputTextBoxValueAccordingtoSelect(e){e.nextElementSibling.value=e.value,inputTextChange()}function setInputTextBoxValueToFirstValue(e){""==e.nextElementSibling.value&&(e.nextElementSibling.value=e.value,inputTextChange())}function inputFieldOnClick(){var e=document.getElementById("inputTextBox");if(0==e.value.length){var t,n=document.getElementById("inputTextSelect");t=document.createEvent("MouseEvents"),t.initMouseEvent("mousedown",!0,!0,window),n.dispatchEvent(t)}}function inputTextChange(){var e=document.getElementById("inputTextBox");""!=e.value?document.getElementById("sendButton").removeAttribute("disabled"):document.getElementById("sendButton").disabled="disabled"}function clickSwitchButton(){var e=(document.getElementById("switchButton"),500001);waitingMessaegReplyID=e,device.send({datapoint:[{id:e,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onSuccess:function(e){"0x00"==e.charAt(0)?head.appendChild(createReceiver("done（临时显示一下）")):"0x01"==e.charAt(0)?head.appendChild(createReceiver("失败了（临时显示一下）")):head.appendChild(createReceiver("返回的是不是01也不是00（临时显示一下）"))},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function pushMessageIntoHeadPanel(e,t){var n=document.getElementById("head");"sender"==e?n.appendChild(createSender(t)):"receiver"==e&&n.appendChild(createReceiver(t)),n.scrollTop=n.scrollHeight}function isNum(e){return null!=e&&""!=e?!isNaN(e):!1}function changeTenToNumber(e){return e="半"==e?.5:"零"==e?0:"一"==e?1:"两"==e?2:"二"==e?2:"三"==e?3:"四"==e?4:"五"==e?5:"六"==e?6:"七"==e?7:"八"==e?8:"九"==e?9:"十"==e?10:-1}function changeChineseToNumber(e){if(isNum(e))return Number(e);if("半"==e)e=.5;else{var t=0,n=10,i=0;e.length>=3?(t=changeTenToNumber(e.charAt(0)),i=changeTenToNumber(e.charAt(2))):2==e.length?(t=changeTenToNumber(e.charAt(0)),i=changeTenToNumber(e.charAt(1)),10==i&&(i=0)):e.length>=1&&(i=changeTenToNumber(e.charAt(0))),e=t*n+i}return e}function beautyMinutes(e){return 0==e?"00":e.toString()}function printDeviceLogFor500003(e,t,n,i,a,s,r,o,c,d,u,g,l){var p="现在时间（20"+e.toString()+"年"+t.toString()+"月"+n+"日 "+i.toString()+":"+beautyMinutes(a)+":"+beautyMinutes(s)+") ";1==g?(p=p+"开灯时间（"+r.toString()+":"+beautyMinutes(o)+") ",255!=c&&(p=p+"关灯时间（"+c.toString()+":"+beautyMinutes(d)+") ")):(p=p+"关灯时间（"+r.toString()+":"+beautyMinutes(o)+") ",255!=c&&(p=p+"开灯时间（"+c.toString()+":"+beautyMinutes(d)+") ")),255==u?p+=" 重复次数: -1 (表示无限)":p=p+" 重复次数: "+u.toString(),1==l?p+=" 从明天开始":2==l?p+=" 从后天开始":0!=l&&(p=p+" 从第"+l+"天开始"),device.log(p)}function sendDelayMessage(e){e=e.replace("个小时","小时"),e=e.replace("个半小时","小时30分钟"),e=e.replace("分后","分钟后");var t=e.indexOf("小时"),n=new Date,i=n.getFullYear()-2e3,a=n.getMonth()+1,s=n.getDate(),r=n.getHours(),o=n.getMinutes(),c=n.getSeconds(),d=0,u=0,g=255,l=255,p=1,v=0;t>0&&(d=e.substring(0,t),d=changeChineseToNumber(d));var h=e.indexOf("分钟");if(h>0&&(u=t>0?e.substring(t+2,h):e.substring(0,h),u=changeChineseToNumber(u)),0>d||0>u||d+u==0)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");if(u+=d%1*60,d=parseInt(d),u+=o,u>=60&&(d+=parseInt(u/60),u%=60),d+=r,d>=24){if(v+=parseInt(d/24),v>2)return void setTimeout(pushMessageIntoHeadPanel,100,"receiver","这都是"+v+"天后的事了，到那个时候再告诉我吧^_^");d%=24}var m=0;e.indexOf("开")>0&&(m=1),printDeviceLogFor500003(255&i,255&a,255&s,255&r,255&o,255&c,255&d,255&u,255&g,255&l,255&p,255&m,255&v);var f=500003;waitingMessaegReplyID=f,device.send({datapoint:[{id:f,apiName:"set_data_point",type:"bytearray",value:[255&i,255&a,255&s,255&r,255&o,255&c,255&d,255&u,255&g,255&l,255&p,255&m,255&v]}],vibrate:1,onSuccess:function(e){device.log("on_time_switch onSuccess: "),pushMessageIntoHeadPanel("receiver","收到!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function sendBreathLightMessage(e){var t=e.indexOf("开"),n=1;0>t&&(n=0);var i=500004;waitingMessaegReplyID=i,device.send({datapoint:[{id:i,apiName:"set_data_point",type:"int32",value:n}],vibrate:1,onSuccess:function(e){device.log("delay_switch onSuccess: "+JSON.stringify(e)),pushMessageIntoHeadPanel("receiver","好的!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function sendCancelMessage(e){var t=500002;waitingMessaegReplyID=t,device.send({datapoint:[{id:t,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onSuccess:function(e){device.log("cancel onSuccess: "+JSON.stringify(e))},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function getMinuteFromString(e){var t=e,n=e.indexOf("点");return n>=0&&(t=e.substring(n+1,e.length)),t.indexOf("分")>0&&(t=t.substring(0,t.indexOf("分"))),"半"==t?30:""!=t?changeChineseToNumber(t):0}function getHourFromString(e){var t=e.substring(0,e.indexOf("点"));return changeChineseToNumber(t)}function replaceAll(e,t,n){return e.indexOf(t)>0?e.replace(new RegExp(t,"g"),n):e}function sendOnTimeSwitchMessage(e){e=e.replace("明早","明天早上"),e=e.replace("明晚","明天晚上"),e=replaceAll(e,":","点"),e=replaceAll(e,"：","点");var t=-1,n=0,i=-1,a=0,s=e.indexOf("下午"),r=!1,o=!1;0>s&&(s=e.indexOf("晚上")),s>=0?r=!0:(s=e.indexOf("早上"),0>s&&(s=e.indexOf("上午")),0>s&&(s=e.indexOf("早晨")));var c=1,d=0;e.indexOf("明天")>=0?(c=1,d=1):e.indexOf("后天")>=0?(c=1,d=2):e.indexOf("每天")>=0&&(c=-1),s>=0?(o=!0,s+=2):(s=e.indexOf("明天"),0>s&&(s=e.indexOf("每天")),0>s&&(s=e.indexOf("后天")),0>s?s=0:s+=2);var u=e.indexOf("打开"),g=1;0>u&&(u=e.indexOf("关"),g=0),0>u&&(u=e.indexOf("开"),g=1);var l=e.substring(s,u);if(t=l.substring(0,l.indexOf("点")),t=changeChineseToNumber(t),0>t)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");var p=new Date,v=p.getFullYear()-2e3,h=p.getMonth()+1,m=p.getDate(),f=p.getHours(),M=p.getMinutes(),I=p.getSeconds(),y=l.indexOf("到");if(y>0){if(n=getMinuteFromString(l.substring(0,y)),l=l.substring(y+1,l.length),i=getHourFromString(l),a=getMinuteFromString(l),0>n||0>i||0>a)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");12>=i&&r?i+=12:1>d&&12>=t&&!o&&(t>f||f==t&&n>M||(12+t>f||f==12+t&&n>M)&&(r=!0,(i>t||i==t&&a>n)&&(i+=12)))}else{if(n=getMinuteFromString(l),0>n)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");12>=t&&!o&&(t>f||f==t&&n>M||(12+t>f||f==12+t&&n>M)&&(r=!0)),d>0&&!o&&(r=!1)}12>=t&&r&&(t+=12),24==t&&(t=0),24==i&&(i=0),printDeviceLogFor500003(255&v,255&h,255&m,255&f,255&M,255&I,255&t,255&n,255&i,255&a,255&c,255&g,255&d);var S=500003;waitingMessaegReplyID=S,device.send({datapoint:[{id:S,apiName:"set_data_point",type:"bytearray",value:[255&v,255&h,255&m,255&f,255&M,255&I,255&t,255&n,255&i,255&a,255&c,255&g,255&d]}],vibrate:1,onSuccess:function(e){device.log("on_time_switch onSuccess: "),pushMessageIntoHeadPanel("receiver","收到!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function isDelaySwitchMessage(e){var t=new RegExp("后开|后关");return t.test(e)}function isOnTimeSwitchMessage(e){var t=new RegExp("到|点开|分开|点关|分关|半关|半开"),n=t.test(e);if(!n){var i=new RegExp("点|:|："),a=new RegExp("开|关");n=i.test(e)&&a.test(e)}return n}function isBreathLightControlMessage(e){var t=new RegExp("到");return t.test(e)}function inputisValid(e){var t=new RegExp("开|关|打开|关闭|开灯|关灯|取消|不要关了|不要开了|恢复|cancel");return t.test(e)}function isBreathLightControlMessage(e){var t=new RegExp("呼吸灯");return t.test(e)}function isCancelMessage(e){var t=new RegExp("取消|不要关了|不要开了|恢复|cancel");return t.test(e)}function clickSendButton(){var e=document.getElementById("inputTextBox"),t=e.value;pushMessageIntoHeadPanel("sender",t),document.getElementById("sendButton").disabled="disabled",e.value="",e.placeholder="点击进行辅助输入",t=t.replace(/\s+/g,""),t=replaceAll(t,"点钟","点"),t=replaceAll(t,"点整","点");var n=(inputisValid(t),!1);inputisValid(t)?isDelaySwitchMessage(t)?(sendDelayMessage(t),n=!0):isOnTimeSwitchMessage(t)?(sendOnTimeSwitchMessage(t),n=!0):isBreathLightControlMessage(t)?(sendBreathLightMessage(t),n=!0):isCancelMessage(t)?sendCancelMessage(t):setTimeout(pushMessageIntoHeadPanel,500,"receiver","我暂时理解不了您说的话，我会努力学习的。"):setTimeout(pushMessageIntoHeadPanel,500,"receiver","我暂时理解不了您说的话"),n&&addMessageIntoCookie(t)}function createReceiver(e){var t=document.createElement("div");t.className="receiver";var n=document.createElement("div"),i=document.createElement("img");n.appendChild(i),i.src="http://wa-ou.com/resources/images/products/qqlightapp-yong.png",t.appendChild(n);var a=document.createElement("div");t.appendChild(a);var s=document.createElement("div");return a.appendChild(s),s.className="right_triangle",a.innerHTML+="<span>"+e+"</span>",t}function createSender(e){var t=document.createElement("div");t.className="sender";var n=document.createElement("div"),i=document.createElement("img");n.appendChild(i),i.src="http://wa-ou.com/resources/images/products/qqlightapp-switch-button-small.png",t.appendChild(n);var a=document.createElement("div");t.appendChild(a);var s=document.createElement("div");return a.appendChild(s),s.className="left_triangle",a.innerHTML+="<span>"+e+"</span>",a.onclick=function(){clickLine(e)},t}function setGuideMessage(){"on"==switchCurrentState?document.getElementById("allGuideMessage1").value="半小时后关灯":document.getElementById("allGuideMessage1").value="半小时后开灯"}function receiveMessage(){device.onReceive(function(e){switch(e.id){case 500010:"0x11"==e.value[0]?(device.log("现在灯是开的状态"),switchCurrentState="on"):"0x10"==e.value[0]?(switchCurrentState="off",device.log("现在开关是关闭状态")):switchCurrentState="on",setGuideMessage();break;case 500003:if(waitingMessaegReplyID==e.id){var t="收到！";alreadySendCancelGuideMessage||(t+="需要取消时，告诉我就可以啦。",alreadySendCancelGuideMessage=!0),pushMessageIntoHeadPanel("receiver",t)}else device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id);break;case 500004:if(waitingMessaegReplyID==e.id){var t="好的，我记下了!";alreadySendCancelGuideMessage||(t+="需要取消时，告诉我就可以啦。",alreadySendCancelGuideMessage=!0),pushMessageIntoHeadPanel("receiver",t)}else device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id);break;case 500002:waitingMessaegReplyID==e.id?pushMessageIntoHeadPanel("receiver","收到，已经取消了!"):device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id)}}),device.onDeviceInfoChange=function(e){device.log("I already capture this, so to hide off-line message")}}function getCurrentSwitchState(){var e=500010;waitingMessaegReplyID=e,device.send({datapoint:[{id:e,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onAck:function(e){}})}function setSwitchButtonSize(){var e=document.getElementById("middle"),t=document.getElementById("switchButton"),n=.8*e.getBoundingClientRect().height;device.log(n),parseInt(n)<180?n=.95*parseInt(n):parseInt(n)<130?n=.9*parseInt(n):parseInt(n)<100&&(n=.7*parseInt(n)),t.style.width=n+"px",t.style.height=t.style.width}function getCookie(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):""}function setCookie(e,t){var n=30,i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()}function addMessageIntoCookie(e){0==sendMessageInCookie.length&&(sendMessageInCookie=getCookie(cookieKey));for(var t=sendMessageInCookie.split(";"),n=0;n<t.length;n++)if(t[n]==e)return;for(var n=0;n<preDefinedMessages.length-t.length;n++)if(preDefinedMessages[n]==e)return;var i=t.length;i>=totalMessageSizeInCookie&&(i=totalMessageSizeInCookie);for(var n=i-1;n>0;n--)t[n]=t[n-1];t[0]=e,sendMessageInCookie="";for(var n=0;n<t.length;n++)0!=t[n].length&&(sendMessageInCookie=sendMessageInCookie+t[n]+";");setCookie(cookieKey,sendMessageInCookie),setSelectOptions()}function setSelectOptions(){var e=document.getElementById("inputTextSelect");0==sendMessageInCookie.length&&(sendMessageInCookie=getCookie(cookieKey));var t=sendMessageInCookie.split(";");e.innerHTML="";for(var n=0;n<t.length;n++)if(t[n].length>0){var i=document.createElement("option");i.value=t[n],i.innerHTML=t[n],e.appendChild(i)}var a=preDefinedMessages.length-t.length;device.debug&&(preDefinedMessages=allDetailedTestMessages,a=preDefinedMessages.length);for(var n=0;a>n;n++)if(t.indexOf(preDefinedMessages[n])<=-1){var i=document.createElement("option");i.value=preDefinedMessages[n],i.innerHTML=preDefinedMessages[n],e.appendChild(i)}}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function initGuideMessages(){var e=getParameterByName("deviceRemark"),t=getParameterByName("userName");""==e&&(e="智能灯"),""!=t&&"蓝牙开关"!=t&&head.appendChild(createReceiver("您好，"+t+"！")),setTimeout(pushMessageIntoHeadPanel,300,"receiver","我是"+e+"，您可以直接发信息给我。"),setTimeout(pushMessageIntoHeadPanel,300,"receiver","点输入框有提示哦！")}device.debug=0,switchCurrentState="on",waitingMessaegReplyID=500010,sendMessageInCookie="",alreadySendCancelGuideMessage=!1,totalMessageSizeInCookie=5,isIOS=0,cookieKey="wa-ou-sent-message",preDefinedMessages=["晚上6点到8点开灯","12点关灯","后天11点关灯","明早5点开灯","每天6点到7点开灯","半小时后关灯","关闭呼吸灯","明早6点开灯"],allDetailedTestMessages=["打开呼吸灯","关闭呼吸灯","1分后关灯","23点到1点开灯","11点到1点开灯","8:20开灯","8：20开灯","8点20开灯","8点20分开灯","上午8点20开灯","下午8点20开灯","晚上8点20开灯","12点半关灯","5点半关灯","五点半关灯","21点半关灯","9点半关灯","晚上6点23分到8点27分开灯","晚上6点到8点27分开灯","晚上6点到8点五十七分开灯","晚上6点到十点五十七开灯","二十点半到零点五十七开灯","12：30到12：50关灯","12:30到12:50关灯","后天晚上9点到11点半开灯","八十八分钟后关灯","八十分钟后关灯","半小时后关灯","一个半小时后关灯","两个半小时后关灯","三个半小时后关灯","一小时50分钟后开灯","一小时一分钟后开灯","明早5点开灯","明早5点三十分开灯","每天6点到7点开灯","每天6点20到7点50开灯","五点整开灯","晚上六点钟到8点钟开灯","后天晚上六点钟到8点钟开灯","每天晚上六点钟到8点钟开灯"],window.onload=function(){document.getElementById("head");setSwitchButtonSize(),receiveMessage(),getCurrentSwitchState(),setSelectOptions(),initGuideMessages(),isIOS=/iPad|iPhone|iPod/.test(navigator.platform)},window.addEventListener("orientationchange",function(){setSwitchButtonSize()},!1);   
    </script>
    <!--[if !IE]>|xGv00|9905a873c2f7497c0c0cd7e24cc02554<![endif]-->
</body>
</html>
