<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta itemprop="name" content="挖藕智能科技轻app" />
    <meta itemprop="description" content="挖藕智能科技的qq物联轻app页面" />
    <meta itemprop="image" content="http://wa-ou.com/images/lightapp-logo.png" />
    <title>我的开关</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <base />
    <style>
     html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;height:100%}body{font-family:"Microsoft Yahei","\5FAE\8F6F\96C5\9ED1",arial,sans-serif;line-height:1.6;height:100%}*{margin:0;padding:0}ul,ol{padding-left:0;list-style-type:none}a{text-decoration:none}div#container{width:100%;height:100%}div#head{position:absolute;width:100%;height:52%;border-style:solid;border-width:0 0 1px;border-color:#B8B8B8;overflow-y:scroll}div#middle{position:absolute;width:100%;height:45%;bottom:0;text-align:center;padding:0;over-flow:hidden;display:inline-block;vertical-align:text-top}div#foot{position:fixed;bottom:0;width:100%;overflow:auto;height:8%;background-color:#F5F5F5;clear:both;text-align:center;min-height:40px}.input-select{position:absolute;width:68%;float:left;height:80%;border:0;outline:0;font-size:16px;text-align:left;left:10px;right:6px;top:10%;bottom:10%}.input-input{position:absolute;width:60%;height:-80%;float:left;border-style:none;font-size:16px;text-align:left;left:12px;right:6px;top:15%;bottom:18%}.sendButton{position:absolute;top:10%;bottom:10%;right:10px;overflow:auto;height:80%;width:20%;text-align:center;float:right;background-color:#FFF;border-style:none;border-radius:4px;margin:auto;font-size:16px}.switchButton{height:80%;background:url(http://wa-ou.com/resources/images/products/qqlightapp-switch-button.jpg) no-repeat center center;background-size:cover;border-radius:400px;border-style:none}.switchButton:hover{background-color:#5788af;border:1px outset #2683cf;color:#fcffdf;padding:3px;margin:1px;text-decoration:none;border-radius:400px}.switchButton:active{background-color:#67b4cf;border:1px inset #1d659f;color:#e0ffaf;padding:4px 2px 2px 4px;margin:1px;text-decoration:none;border-radius:400px}.line1{position:absolute;left:35px;color:gray;font-size:28px}.line2{position:absolute;right:35px;color:gray;font-size:28px}.sender{clear:both;padding:20px 0 0}.sender div:nth-of-type(1){float:left}.sender div:nth-of-type(2){background-color:#F5F5F5;float:left;margin:0 7px 7px 10px;padding:7px 7px 7px 0;border-radius:5px;font-size:16px}.receiver div:first-child img,.sender div:first-child img{width:33px;height:33px}.receiver{clear:both}.receiver div:nth-child(1){float:right}.receiver div:nth-of-type(2){float:right;background-color:#F5F5F5;margin:0 7px 7px 10px;padding:7px 0 7px 7px;border-radius:5px;font-size:16px}.left_triangle{height:0;width:0;border-width:5px;border-style:solid;border-color:transparent #F5F5F5 transparent transparent;position:relative;left:-10px;top:2px}.right_triangle{height:0;width:0;border-width:5px;border-style:solid;border-color:transparent transparent transparent #F5F5F5;position:relative;right:-10px;top:2px}  
    </style>
</head>

<body>
    <div id="container">
        <div id="head"></div>
        
        <div id="middle">
            <button class="switchButton" id="switchButton" style=""  onClick="clickSwitchButton()" ></button>
        </div>
        
        <div id="foot" >     
            <select  class="input-select"  id="inputTextSelect" onchange="setInputTextBoxValueAccordingtoSelect(this)" onClick="setInputTextBoxValueToFirstValue(this)" onFocus="setInputTextBoxValueToFirstValue(this)">

			</select>
			<input class="input-input" id="inputTextBox" placeholder="点击进行辅助输入" oninput="inputTextChange()" onClick="inputFieldOnClick()"/>
            <button class="sendButton" id="sendButton" disabled="disabled" onClick="clickSendButton()">发送</button>
        </div>
    </div>
    <script src="http://qzonestyle.gtimg.cn/open/mobile/light_app/js/device.js"></script>
    <script>
    function clickLine(e){document.getElementById("inputTextBox").value=e,document.getElementById("sendButton").removeAttribute("disabled")}function setInputTextBoxValueAccordingtoSelect(e){e.nextElementSibling.value=e.value,inputTextChange()}function setInputTextBoxValueToFirstValue(e){""==e.nextElementSibling.value&&(e.nextElementSibling.value=e.value,inputTextChange())}function inputFieldOnClick(){var e=document.getElementById("inputTextBox");if(0==e.value.length){var n,t=document.getElementById("inputTextSelect");n=document.createEvent("MouseEvents"),n.initMouseEvent("mousedown",!0,!0,window),t.dispatchEvent(n)}}function inputTextChange(){var e=document.getElementById("inputTextBox");""!=e.value?document.getElementById("sendButton").removeAttribute("disabled"):document.getElementById("sendButton").disabled="disabled"}function send500001Message(e){var n=(document.getElementById("switchButton"),500001);waitingMessaegReplyID=n,device.send({datapoint:[{id:n,apiName:"set_data_point",type:"int32",value:e}],vibrate:1,onSuccess:function(e){"0x00"==e.charAt(0)?head.appendChild(createReceiver("done（临时显示一下）")):"0x01"==e.charAt(0)?head.appendChild(createReceiver("失败了（临时显示一下）")):head.appendChild(createReceiver("返回的是不是01也不是00（临时显示一下）"))},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function clickSwitchButton(){send500001Message(-1)}function pushMessageIntoHeadPanel(e,n){var t=document.getElementById("head");"sender"==e?t.appendChild(createSender(n)):"receiver"==e&&t.appendChild(createReceiver(n)),t.scrollTop=t.scrollHeight}function isNum(e){return null!=e&&""!=e?!isNaN(e):!1}function changeTenToNumber(e){return e="半"==e?.5:"零"==e?0:"一"==e?1:"两"==e?2:"二"==e?2:"三"==e?3:"四"==e?4:"五"==e?5:"六"==e?6:"七"==e?7:"八"==e?8:"九"==e?9:"十"==e?10:-1}function changeChineseToNumber(e){if(isNum(e))return Number(e);if("半"==e)e=.5;else{var n=0,t=10,i=0;e.length>=3?(n=changeTenToNumber(e.charAt(0)),i=changeTenToNumber(e.charAt(2))):2==e.length?(n=changeTenToNumber(e.charAt(0)),i=changeTenToNumber(e.charAt(1)),10==i&&(i=0)):e.length>=1&&(i=changeTenToNumber(e.charAt(0))),e=n*t+i}return e}function beautyMinutes(e){return 0==e?"00":e.toString()}function printDeviceLogFor500003(e,n,t,i,a,s,r,o,d,c,g,u,l){var p="现在时间（20"+e.toString()+"年"+n.toString()+"月"+t+"日 "+i.toString()+":"+beautyMinutes(a)+":"+beautyMinutes(s)+") ";1==u?(p=p+"开灯时间（"+r.toString()+":"+beautyMinutes(o)+") ",255!=d&&(p=p+"关灯时间（"+d.toString()+":"+beautyMinutes(c)+") ")):(p=p+"关灯时间（"+r.toString()+":"+beautyMinutes(o)+") ",255!=d&&(p=p+"开灯时间（"+d.toString()+":"+beautyMinutes(c)+") ")),255==g?p+=" 重复次数: -1 (表示无限)":p=p+" 重复次数: "+g.toString(),1==l?p+=" 从明天开始":2==l?p+=" 从后天开始":0!=l&&(p=p+" 从第"+l+"天开始"),device.log(p)}function sendDelayMessage(e){e=e.replace("个小时","小时"),e=e.replace("个半小时","小时30分钟"),e=e.replace("分后","分钟后");var n=e.indexOf("小时"),t=new Date,i=t.getFullYear()-2e3,a=t.getMonth()+1,s=t.getDate(),r=t.getHours(),o=t.getMinutes(),d=t.getSeconds(),c=0,g=0,u=255,l=255,p=1,v=0;n>0&&(c=e.substring(0,n),c=changeChineseToNumber(c));var h=e.indexOf("分钟");if(h>0&&(g=n>0?e.substring(n+2,h):e.substring(0,h),g=changeChineseToNumber(g)),0>c||0>g||c+g==0)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");if(g+=c%1*60,c=parseInt(c),g+=o,g>=60&&(c+=parseInt(g/60),g%=60),c+=r,c>=24){if(v+=parseInt(c/24),v>2)return void setTimeout(pushMessageIntoHeadPanel,100,"receiver","这都是"+v+"天后的事了，到那个时候再告诉我吧^_^");c%=24}var m=0;e.indexOf("开")>0&&(m=1),printDeviceLogFor500003(255&i,255&a,255&s,255&r,255&o,255&d,255&c,255&g,255&u,255&l,255&p,255&m,255&v);var f=500003;waitingMessaegReplyID=f,device.send({datapoint:[{id:f,apiName:"set_data_point",type:"bytearray",value:[255&i,255&a,255&s,255&r,255&o,255&d,255&c,255&g,255&u,255&l,255&p,255&m,255&v]}],vibrate:1,onSuccess:function(e){device.log("on_time_switch onSuccess: "),pushMessageIntoHeadPanel("receiver","收到!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function sendBreathLightMessage(e){var n=e.indexOf("开"),t=1;0>n&&(t=0);var i=500004;waitingMessaegReplyID=i,device.send({datapoint:[{id:i,apiName:"set_data_point",type:"int32",value:t}],vibrate:1,onSuccess:function(e){device.log("delay_switch onSuccess: "+JSON.stringify(e)),pushMessageIntoHeadPanel("receiver","好的!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function sendCancelMessage(e){var n=500002;waitingMessaegReplyID=n,device.send({datapoint:[{id:n,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onSuccess:function(e){device.log("cancel onSuccess: "+JSON.stringify(e))},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function getMinuteFromString(e){var n=e,t=e.indexOf("点");return t>=0&&(n=e.substring(t+1,e.length)),n.indexOf("分")>0&&(n=n.substring(0,n.indexOf("分"))),"半"==n?30:""!=n?changeChineseToNumber(n):0}function getHourFromString(e){var n=e.substring(0,e.indexOf("点"));return changeChineseToNumber(n)}function replaceAll(e,n,t){return e.indexOf(n)>0?e.replace(new RegExp(n,"g"),t):e}function sendOnTimeSwitchMessage(e){e=e.replace("明早","明天早上"),e=e.replace("明晚","明天晚上"),e=replaceAll(e,":","点"),e=replaceAll(e,"：","点");var n=-1,t=0,i=-1,a=0,s=e.indexOf("下午"),r=!1,o=!1;0>s&&(s=e.indexOf("晚上")),s>=0?r=!0:(s=e.indexOf("早上"),0>s&&(s=e.indexOf("上午")),0>s&&(s=e.indexOf("早晨")));var d=1,c=0;e.indexOf("明天")>=0?(d=1,c=1):e.indexOf("后天")>=0?(d=1,c=2):e.indexOf("每天")>=0&&(d=-1),s>=0?(o=!0,s+=2):(s=e.indexOf("明天"),0>s&&(s=e.indexOf("每天")),0>s&&(s=e.indexOf("后天")),0>s?s=0:s+=2);var g=e.indexOf("打开"),u=1;0>g&&(g=e.indexOf("关"),u=0),0>g&&(g=e.indexOf("开"),u=1);var l=e.substring(s,g);if(n=l.substring(0,l.indexOf("点")),n=changeChineseToNumber(n),0>n)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");var p=new Date,v=p.getFullYear()-2e3,h=p.getMonth()+1,m=p.getDate(),f=p.getHours(),M=p.getMinutes(),I=p.getSeconds(),y=l.indexOf("到");if(y>0){if(t=getMinuteFromString(l.substring(0,y)),l=l.substring(y+1,l.length),i=getHourFromString(l),a=getMinuteFromString(l),0>t||0>i||0>a)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");12>=i&&r?i+=12:1>c&&12>=n&&!o&&(n>f||f==n&&t>M||(12+n>f||f==12+n&&t>M)&&(r=!0,(i>n||i==n&&a>t)&&(i+=12)))}else{if(t=getMinuteFromString(l),0>t)return void setTimeout(pushMessageIntoHeadPanel,500,"receiver","您设置的时间太深奥，我理解不了");12>=n&&!o&&(n>f||f==n&&t>M||(12+n>f||f==12+n&&t>M)&&(r=!0)),c>0&&!o&&(r=!1)}12>=n&&r&&(n+=12),24==n&&(n=0),24==i&&(i=0),1>c&&(f>n||f==n&&M>t)&&(c=1),printDeviceLogFor500003(255&v,255&h,255&m,255&f,255&M,255&I,255&n,255&t,255&i,255&a,255&d,255&u,255&c);var S=500003;waitingMessaegReplyID=S,device.send({datapoint:[{id:S,apiName:"set_data_point",type:"bytearray",value:[255&v,255&h,255&m,255&f,255&M,255&I,255&n,255&t,255&i,255&a,255&d,255&u,255&c]}],vibrate:1,onSuccess:function(e){device.log("on_time_switch onSuccess: "),pushMessageIntoHeadPanel("receiver","收到!")},onError:function(e){device.log("onError: "+JSON.stringify(e))}})}function isDelaySwitchMessage(e){var n=new RegExp("后开|后关");return n.test(e)}function isOnTimeSwitchMessage(e){var n=new RegExp("到|点开|分开|点关|分关|半关|半开"),t=n.test(e);if(!t){var i=new RegExp("点|:|："),a=new RegExp("开|关");t=i.test(e)&&a.test(e)}return t}function isBreathLightControlMessage(e){var n=new RegExp("到");return n.test(e)}function inputisValid(e){var n=new RegExp("开|关|打开|关闭|开灯|关灯|取消|不要关了|不要开了|恢复|cancel");return n.test(e)}function isBreathLightControlMessage(e){var n=new RegExp("呼吸灯");return n.test(e)}function isCancelMessage(e){var n=new RegExp("取消|不要关了|不要开了|恢复|cancel");return n.test(e)}function clickSendButton(){var e=document.getElementById("inputTextBox"),n=e.value;pushMessageIntoHeadPanel("sender",n),document.getElementById("sendButton").disabled="disabled",e.value="",e.placeholder="点击进行辅助输入",n=n.replace(/\s+/g,""),n=replaceAll(n,"点钟","点"),n=replaceAll(n,"点整","点");var t=(inputisValid(n),!1);inputisValid(n)?"关灯"==n||"关闭"==n||"关"==n||"off"==n?send500001Message(0):"开灯"==n||"打开"==n||"开"==n||"on"==n?send500001Message(1):isDelaySwitchMessage(n)?(sendDelayMessage(n),t=!0):isOnTimeSwitchMessage(n)?(sendOnTimeSwitchMessage(n),t=!0):isBreathLightControlMessage(n)?(sendBreathLightMessage(n),t=!0):isCancelMessage(n)?sendCancelMessage(n):setTimeout(pushMessageIntoHeadPanel,500,"receiver","我暂时理解不了您说的话，我会努力学习的。"):setTimeout(pushMessageIntoHeadPanel,500,"receiver","我暂时理解不了您说的话"),t&&addMessageIntoCookie(n)}function createReceiver(e){var n=document.createElement("div");n.className="receiver";var t=document.createElement("div"),i=document.createElement("img");t.appendChild(i),i.src="http://wa-ou.com/resources/images/products/qqlightapp-yong.png",n.appendChild(t);var a=document.createElement("div");n.appendChild(a);var s=document.createElement("div");return a.appendChild(s),s.className="right_triangle",a.innerHTML+="<span>"+e+"</span>",n}function createSender(e){var n=document.createElement("div");n.className="sender";var t=document.createElement("div"),i=document.createElement("img");t.appendChild(i),i.src="http://wa-ou.com/resources/images/products/qqlightapp-switch-button-small.png",n.appendChild(t);var a=document.createElement("div");n.appendChild(a);var s=document.createElement("div");return a.appendChild(s),s.className="left_triangle",a.innerHTML+="<span>"+e+"</span>",a.onclick=function(){clickLine(e)},n}function setGuideMessage(){"on"==switchCurrentState?document.getElementById("allGuideMessage1").value="半小时后关灯":document.getElementById("allGuideMessage1").value="半小时后开灯"}function receiveMessage(){device.onReceive(function(e){switch(e.id){case 500010:"0x11"==e.value[0]?(device.log("现在灯是开的状态"),switchCurrentState="on"):"0x10"==e.value[0]?(switchCurrentState="off",device.log("现在开关是关闭状态")):switchCurrentState="on",setGuideMessage();break;case 500003:if(waitingMessaegReplyID==e.id){var n="收到！";alreadySendCancelGuideMessage||(n+="需要取消时，告诉我就可以啦。",alreadySendCancelGuideMessage=!0),pushMessageIntoHeadPanel("receiver",n)}else device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id);break;case 500004:if(waitingMessaegReplyID==e.id){var n="好的，我记下了!";alreadySendCancelGuideMessage||(n+="需要取消时，告诉我就可以啦。",alreadySendCancelGuideMessage=!0),pushMessageIntoHeadPanel("receiver",n)}else device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id);break;case 500002:waitingMessaegReplyID==e.id?pushMessageIntoHeadPanel("receiver","收到，已经取消了!"):device.log("waitingMessaegReplyID = "+waitingMessaegReplyID+", but got: "+e.id)}}),device.onDeviceInfoChange=function(e){device.log("I already capture this, so to hide off-line message")}}function getCurrentSwitchState(){var e=500010;waitingMessaegReplyID=e,device.send({datapoint:[{id:e,apiName:"set_data_point",type:"int32",value:1}],vibrate:1,onAck:function(e){}})}function setSwitchButtonSize(){var e=document.getElementById("middle"),n=document.getElementById("switchButton"),t=.8*e.getBoundingClientRect().height;device.log(t),parseInt(t)<180?t=.95*parseInt(t):parseInt(t)<130?t=.9*parseInt(t):parseInt(t)<100&&(t=.7*parseInt(t)),n.style.width=t+"px",n.style.height=n.style.width}function getCookie(e){var n,t=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(n=document.cookie.match(t))?unescape(n[2]):""}function setCookie(e,n){var t=30,i=new Date;i.setTime(i.getTime()+24*t*60*60*1e3),document.cookie=e+"="+escape(n)+";expires="+i.toGMTString()}function addMessageIntoCookie(e){0==sendMessageInCookie.length&&(sendMessageInCookie=getCookie(cookieKey));for(var n=sendMessageInCookie.split(";"),t=0;t<n.length;t++)if(n[t]==e)return;for(var t=0;t<preDefinedMessages.length-n.length;t++)if(preDefinedMessages[t]==e)return;var i=n.length;i>=totalMessageSizeInCookie&&(i=totalMessageSizeInCookie);for(var t=i-1;t>0;t--)n[t]=n[t-1];n[0]=e,sendMessageInCookie="";for(var t=0;t<n.length;t++)0!=n[t].length&&(sendMessageInCookie=sendMessageInCookie+n[t]+";");setCookie(cookieKey,sendMessageInCookie),setSelectOptions()}function setSelectOptions(){var e=document.getElementById("inputTextSelect");0==sendMessageInCookie.length&&(sendMessageInCookie=getCookie(cookieKey));var n=sendMessageInCookie.split(";");e.innerHTML="";for(var t=0;t<n.length;t++)if(n[t].length>0){var i=document.createElement("option");i.value=n[t],i.innerHTML=n[t],e.appendChild(i)}var a=preDefinedMessages.length-n.length;device.debug&&(preDefinedMessages=allDetailedTestMessages,a=preDefinedMessages.length);for(var t=0;a>t;t++)if(n.indexOf(preDefinedMessages[t])<=-1){var i=document.createElement("option");i.value=preDefinedMessages[t],i.innerHTML=preDefinedMessages[t],e.appendChild(i)}}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=n.exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function initGuideMessages(){var e=getParameterByName("deviceRemark"),n=getParameterByName("userName");""==e&&(e="智能灯"),""!=n&&"蓝牙开关"!=n&&head.appendChild(createReceiver("您好，"+n+"！")),setTimeout(pushMessageIntoHeadPanel,300,"receiver","我是"+e+"，您可以直接发信息给我。"),setTimeout(pushMessageIntoHeadPanel,300,"receiver","点输入框有提示哦！")}device.debug=0,switchCurrentState="on",waitingMessaegReplyID=500010,sendMessageInCookie="",alreadySendCancelGuideMessage=!1,totalMessageSizeInCookie=5,isIOS=0,cookieKey="wa-ou-sent-message",preDefinedMessages=["晚上6点到8点开灯","12点关灯","后天11点关灯","明早5点开灯","每天6点到7点开灯","半小时后关灯","关闭呼吸灯","明早6点开灯"],allDetailedTestMessages=["打开呼吸灯","关闭呼吸灯","1分后关灯","23点到1点开灯","11点到1点开灯","8:20开灯","8：20开灯","8点20开灯","8点20分开灯","上午8点20开灯","下午8点20开灯","晚上8点20开灯","12点半关灯","5点半关灯","五点半关灯","21点半关灯","9点半关灯","晚上6点23分到8点27分开灯","晚上6点到8点27分开灯","晚上6点到8点五十七分开灯","晚上6点到十点五十七开灯","二十点半到零点五十七开灯","12：30到12：50关灯","12:30到12:50关灯","后天晚上9点到11点半开灯","八十八分钟后关灯","八十分钟后关灯","半小时后关灯","一个半小时后关灯","两个半小时后关灯","三个半小时后关灯","一小时50分钟后开灯","一小时一分钟后开灯","明早5点开灯","明早5点三十分开灯","每天6点到7点开灯","每天6点20到7点50开灯","五点整开灯","晚上六点钟到8点钟开灯","后天晚上六点钟到8点钟开灯","每天晚上六点钟到8点钟开灯"],window.onload=function(){document.getElementById("head");setSwitchButtonSize(),receiveMessage(),getCurrentSwitchState(),setSelectOptions(),initGuideMessages(),isIOS=/iPad|iPhone|iPod/.test(navigator.platform)},window.addEventListener("orientationchange",function(){setSwitchButtonSize()},!1);
        
    </script>
    <!--[if !IE]>|xGv00|9905a873c2f7497c0c0cd7e24cc02554<![endif]-->
</body>
</html>
